---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/sections/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/sections/Header.astro';
import PostMeta from '../components/ui/meta/PostMeta.astro';
import ShareButtons from '../components/ui/share/ShareButtons.astro';
import PostNav from '../components/ui/nav/PostNav.astro';

type BlogData = CollectionEntry<'blog'>['data'];
type Props = BlogData & { showHeader?: boolean; prevPost?: { id: string; title: string } | null; nextPost?: { id: string; title: string } | null; readingTimeMin?: number };

const { title, description, pubDate, updatedDate, heroImage, showHeader = true, prevPost = null, nextPost = null, readingTimeMin = 0 } = Astro.props as Props;
---

<html lang="en" data-theme="dark" class="dark">
	<head>
		<BaseHead title={title} description={description} image={heroImage} />
		<meta property="og:type" content="article" />
		{pubDate && <meta property="article:published_time" content={new Date(pubDate).toISOString()} />}
		{updatedDate && <meta property="article:modified_time" content={new Date(updatedDate).toISOString()} />}
		<meta property="article:author" content={Astro.props.author || 'Site Author'} />
		{Array.isArray(Astro.props.tags) && Astro.props.tags.map((t) => (
		  <meta property="article:tag" content={t} />
		))}

		<script type="application/ld+json" set:html={JSON.stringify({
		  '@context': 'https://schema.org',
		  '@type': 'Article',
		  headline: title,
		  description,
		  image: Astro.props.heroImage ? new URL(Astro.props.heroImage.src, Astro.site).toString() : undefined,
		  datePublished: pubDate ? new Date(pubDate).toISOString() : undefined,
		  dateModified: updatedDate ? new Date(updatedDate).toISOString() : undefined,
		  author: [{ '@type': 'Person', name: Astro.props.author || 'Site Author' }],
		  publisher: { '@type': 'Organization', name: 'Austin Crockett' },
		  mainEntityOfPage: new URL(Astro.url.pathname, Astro.site).toString(),
		  url: new URL(Astro.url.pathname, Astro.site).toString(),
		})} />

		<script type="application/ld+json" set:html={JSON.stringify({
		  '@context': 'https://schema.org',
		  '@type': 'BreadcrumbList',
		  itemListElement: [
		    { '@type': 'ListItem', position: 1, name: 'Home', item: new URL('/', Astro.site).toString() },
		    { '@type': 'ListItem', position: 2, name: 'Blog', item: new URL('/blog/', Astro.site).toString() },
		    { '@type': 'ListItem', position: 3, name: title, item: new URL(Astro.url.pathname, Astro.site).toString() },
		  ],
		})} />
	</head>

	<body class="bg-background text-foreground">
		<Header />
		<main class="w-full max-w-6xl mx-auto px-6 py-8 bg-background">
			<article>
				{showHeader && heroImage && (
					<div class="w-full mb-8">
						<Image
							width={1020}
							height={510}
							src={heroImage}
							alt=""
							class="block mx-auto rounded-xl shadow-lg"
						/>
					</div>
				)}
				<div class="prose prose-lg max-w-3xl mx-auto text-muted-foreground">
					{showHeader && (
						<div class="text-center mb-8 pb-8 border-b border-border">
							<div class="mb-4 text-muted-foreground">
								<FormattedDate date={pubDate} />
								{updatedDate && (
									<div class="italic mt-1">
										Last updated on <FormattedDate date={updatedDate} />
									</div>
								)}
							</div>
							<h1 class="text-3xl md:text-4xl font-normal text-foreground m-0">{title}</h1>
						</div>
					)}
					<ShareButtons title={title} url={Astro.url.toString()} />
					<PostMeta pubDate={pubDate} readingTimeMin={readingTimeMin} authorName={Astro.props.author || 'Site Author'} />
					<slot />
					<PostNav prev={prevPost} next={nextPost} />
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
