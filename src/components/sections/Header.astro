---
import { SITE_TITLE } from '../../consts';
import { MobileNav } from '../react/MobileNav';
import { ThemeToggle } from '../react/ThemeToggle';
import { Button } from '../ui/button';

// Get current path for active link detection
const pathname = Astro.url.pathname;

// Navigation links configuration
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/portfolio', label: 'Portfolio' },
  { href: '/about', label: 'About' },
  { href: '/blog', label: 'Blog' },
];

// Check if link is active
function isActive(href: string): boolean {
  if (href === '/') return pathname === '/';
  return pathname.startsWith(href);
}
---

<header class="site-header fixed top-0 left-0 right-0 z-50 px-4 sm:px-6 lg:px-8 pointer-events-none">
    <div class="header-container">
        <!-- Logo Section - LEFT edge, outside pill -->
        <a class="logo-link pointer-events-auto" href="/" aria-label="Home">
            <div class="logo-badge">
                <span class="logo-initials">AC</span>
            </div>
            <span class="logo-name hidden sm:block">Austin Crockett</span>
        </a>

        <!-- Desktop Navigation Pill - RIGHT side -->
        <div class="nav-pill hidden md:flex pointer-events-auto">
            <nav class="nav-links">
                {navLinks.map((link) => (
                    <a
                        href={link.href}
                        class:list={[
                            "nav-link",
                            { "nav-link-active": isActive(link.href) }
                        ]}
                    >
                        {link.label}
                    </a>
                ))}
            </nav>

            <ThemeToggle client:load />

            <a href="/contact">
                <Button className="rounded-full nav-cta">
                    Contact
                </Button>
            </a>
        </div>

        <!-- Mobile: Theme Toggle + Hamburger -->
        <div class="flex items-center gap-2 md:hidden pointer-events-auto">
            <ThemeToggle client:load />
            <MobileNav
                client:load
                links={navLinks}
                currentPath={pathname}
            />
        </div>
    </div>
</header>

<style>
    /* Header - Initial state with more top padding */
    .site-header {
        padding-top: 2rem;
        transition: padding-top 0.3s ease;
    }

    /* Header - Scrolled state with reduced padding */
    .site-header.header-scrolled {
        padding-top: 1rem;
    }

    /* Full-width Header Container */
    .header-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Logo Section - Outside pill, on left edge */
    .logo-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        flex-shrink: 0;
    }

    .logo-badge {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        background: var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease;
    }

    .logo-link:hover .logo-badge {
        transform: scale(1.05);
    }

    .logo-initials {
        color: #0D1117;
        font-weight: 700;
        font-size: 0.875rem;
        letter-spacing: -0.02em;
    }

    .logo-name {
        font-weight: 600;
        font-size: 1rem;
        color: var(--foreground);
    }

    /* Navigation Pill - Frosted glass effect */
    .nav-pill {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.375rem 0.375rem 0.375rem 1rem;
        background: color-mix(in oklch, var(--background) 92%, transparent);
        border-radius: 60px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        backdrop-filter: blur(16px);
        border: 1px solid var(--border);
    }

    :global(.dark) .nav-pill {
        background: color-mix(in oklch, var(--background) 85%, transparent);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
    }

    .nav-links {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    /* Nav Links */
    .nav-link {
        display: inline-block;
        text-decoration: none;
        color: var(--muted-foreground);
        font-size: 0.9375rem;
        font-weight: 400;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        transition: color 0.2s ease, background-color 0.2s ease;
    }

    .nav-link:hover {
        color: var(--foreground);
        background-color: var(--muted);
    }

    .nav-link-active {
        color: var(--primary);
        font-weight: 500;
    }

    /* Contact CTA Button styling */
    :global(.nav-cta) {
        background: var(--accent) !important;
        color: #0D1117 !important;
        border: none !important;
    }

    :global(.nav-cta:hover) {
        background: #0FD4B8 !important;
    }
</style>

<script>
    // Ensure dark mode is applied on initial load before React hydrates
    (function() {
        const stored = localStorage.getItem('theme');
        const root = document.documentElement;

        if (stored === 'light') {
            root.classList.remove('dark');
            root.dataset.theme = 'light';
        } else {
            // Default to dark
            root.classList.add('dark');
            root.dataset.theme = 'dark';
        }
    })();

    // Header scroll behavior - reduce padding on scroll
    (function() {
        const header = document.querySelector('.site-header');
        if (!header) return;

        const scrollThreshold = 50;

        function updateHeader() {
            if (window.scrollY > scrollThreshold) {
                header.classList.add('header-scrolled');
            } else {
                header.classList.remove('header-scrolled');
            }
        }

        // Initial check
        updateHeader();

        // Listen for scroll
        window.addEventListener('scroll', updateHeader, { passive: true });
    })();
</script>
