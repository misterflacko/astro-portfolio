---
import type { CollectionEntry } from 'astro:content';
import { Card, CardContent } from '../ui/card';
import { ArrowRight } from 'lucide-react';

interface Props {
  title?: string;
  subtitle?: string;
  posts: CollectionEntry<'blog'>[];
  showViewAll?: boolean;
}

const { title, subtitle, posts, showViewAll = true } = Astro.props;

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric'
  });
}
---

<section class="py-8 md:py-12">
  {(title || subtitle) && (
    <header class="flex flex-col sm:flex-row sm:justify-between sm:items-end gap-4 mb-10 md:mb-14">
      <div class="flex-1">
        {title && <h2 class="text-3xl md:text-4xl lg:text-5xl font-semibold text-foreground mb-3 tracking-tight">{title}</h2>}
        {subtitle && <p class="text-lg text-muted-foreground leading-relaxed">{subtitle}</p>}
      </div>
      {showViewAll && (
        <a href="/blog" class="inline-flex items-center gap-1.5 text-[15px] font-medium text-foreground hover:text-primary transition-colors group shrink-0">
          View all posts
          <ArrowRight className="h-3.5 w-3.5 transition-transform group-hover:translate-x-0.5" />
        </a>
      )}
    </header>
  )}

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
    {posts.map((post) => (
      <Card className="group overflow-hidden bg-card/50 hover:bg-card border-border/50 hover:border-border transition-all duration-200 hover:-translate-y-0.5">
        {post.data.heroImage && (
          <a href={`/blog/${post.slug}`} class="block aspect-video overflow-hidden">
            <img
              src={post.data.heroImage}
              alt={post.data.title}
              class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"
              loading="lazy"
            />
          </a>
        )}
        <CardContent className="p-6 flex flex-col flex-1">
          <time class="text-[13px] font-medium text-primary uppercase tracking-wide mb-3" datetime={post.data.pubDate.toISOString()}>
            {formatDate(post.data.pubDate)}
          </time>
          <h3 class="text-lg font-medium leading-snug mb-3">
            <a href={`/blog/${post.slug}`} class="text-foreground hover:text-primary transition-colors">
              {post.data.title}
            </a>
          </h3>
          {post.data.description && (
            <p class="text-[15px] text-muted-foreground leading-relaxed flex-1 line-clamp-3">
              {post.data.description}
            </p>
          )}
          <a href={`/blog/${post.slug}`} class="inline-flex items-center gap-1.5 mt-4 text-sm font-medium text-foreground hover:text-primary transition-colors group/link">
            Read more
            <ArrowRight className="h-3.5 w-3.5 transition-transform group-hover/link:translate-x-0.5" />
          </a>
        </CardContent>
      </Card>
    ))}
  </div>
</section>
